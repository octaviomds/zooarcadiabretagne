if("undefined"==typeof buildfire)throw"please add buildfire.js first to use BuildFire services";buildfire.gamify||(buildfire.gamify={}),buildfire.gamify.Scoreboard=function(e,i,t){this.size=i||10,this.autoSubscribeToPushNotification=t,this.size<1&&(this.size=10),this.tagName=e||"scoreboard",this.pushGroupName="scoreboard_"+this.tagName},buildfire.gamify.Scoreboard.prototype={size:10,getScoreboard:function(t){buildfire.publicData.get(this.tagName,function(e,i){e?t(e):i.data.topScores?t(void 0,i.data):t(void 0,{gamesPlayed:0,topScores:[]})})},reset:function(){buildfire.publicData.save({gamesPlayed:0,topScores:[]},this.tagName,function(){})},_PNEnabled:function(){return buildfire.notifications&&buildfire.notifications.pushNotification},subscribe:function(i){return!!this._PNEnabled()&&(buildfire.notifications.pushNotification.subscribe({groupName:this.pushGroupName},function(e){e&&console.error(e),i&&i(e)}),!0)},unsubscribe:function(i){return!!this._PNEnabled()&&(buildfire.notifications.pushNotification.unsubscribe({groupName:this.pushGroupName},function(e){e&&console.error(e),i&&i(e)}),!0)},logScore:function(n,c,d){this.autoSubscribeToPushNotification&&(this.subscribe()||console.warn("Cannot subscribe to scoreboard push notifications because buildfire push notification services is not attached"));var f=this,l=new Date;buildfire.publicData.get(this.tagName,function(e,i){function t(e){e&&d(e)}var o,a={user:n,score:c,createdOn:l},s={gamesPlayed:0,topScores:[a]};if(e)d(e);else if(i)if(i.data.topScores){i.data.topScores.length>f.size&&i.data.topScores[f.size-1].score>c&&d(),(s=i.data).topScores.push(a),s.topScores=s.topScores.sort(function(e,i){return i.score-e.score}),s.topScores.length>f.size&&(u=s.topScores.pop()),s.gamesPlayed++,buildfire.publicData.update(i.id,s,f.tagName,t);for(var r=0;r<s.topScores.length;r++)if(s.topScores[r].createdOn==l){o=r;break}var u={bumpedOff:u,rankedAt:o};f._PNEnabled()&&(u.bumpedOff&&u.bumpedOff.user.email!=n.email&&buildfire.notifications.pushNotification.schedule({title:"You got kicked off !!!",text:"Your old score is no longer on the top 10. "+n.displayName+" has taken your spot. Honestly, I dont know how you sleep at night.",users:[u.bumpedOff.user.id]},t),0==o&&buildfire.notifications.pushNotification.schedule({title:"There is a new champion!",text:n.displayName+" has taken the lead at the new undisputed champion with a score of "+c,groupName:f.pushGroupName},t),1==o&&buildfire.notifications.pushNotification.schedule({title:"There is a challenger to the champion",text:n.displayName+" has taken 2nd place with a score of "+c+". Watch out "+s.topScores[0].user.displayName,groupName:f.pushGroupName},t),2==o&&buildfire.notifications.pushNotification.schedule({title:"There is a kid in town!",text:n.displayName+" has taken 3rd place. Keep an eye on this one",groupName:f.pushGroupName},t)),d(null,u)}else s.gamesPlayed++,buildfire.publicData.save(s,f.tagName,t);else s.gamesPlayed++,buildfire.publicData.save(s,f.tagName,t),d(null,{rankedAt:0})})}};
//# sourceMappingURL=scoreboard.min.js.map
